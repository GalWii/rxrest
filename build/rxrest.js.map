{"version":3,"file":"rxrest.js","sources":["../src/RxRestProxyHandler.ts","../src/utils.ts","../src/fetch.ts","../src/RxRestConfiguration.ts","../src/RxRest.ts","../src/index.ts"],"sourcesContent":["import {RxRest} from './RxRest'\n\nexport class RxRestProxyHandler<F, T> implements ProxyHandler<RxRest<F, T>> {\n  private $internal: PropertyKey[] = [];\n  private $instance: F;\n\n  constructor(target: F) {\n    this.$instance = target\n    do {\n      this.$internal = this.$internal.concat(\n        Object.getOwnPropertyNames(target), Object.getOwnPropertySymbols(target)\n      )\n    } while (target = Object.getPrototypeOf(target))\n  }\n\n  getPrototypeOf(target: any) {\n    return Object.getPrototypeOf(this.$instance)\n  }\n\n  defineProperty(target: any, p: PropertyKey, attributes: PropertyDescriptor): boolean {\n    if (~this.$internal.indexOf(p)) {\n      return true\n    }\n\n    Object.defineProperty(target, p, attributes)\n    return true\n  }\n\n  deleteProperty(target: any, p: PropertyKey): boolean {\n    return delete target[p]\n  }\n\n  set(target: any, p: PropertyKey, value: any, receiver: any): boolean {\n\n    if (~this.$internal.indexOf(p)) {\n      this.$instance[p] = value\n      return true\n    }\n\n    if ((this.$instance as any).$pristine === true) {\n      (this.$instance as any).$pristine = false\n    }\n\n    target[p] = value\n    return true\n  }\n\n  get(target: any, p: PropertyKey, receiver: any): any {\n    if (~this.$internal.indexOf(p)) {\n      return this.$instance[p]\n    }\n\n    return target[p]\n  }\n}\n","export function objectToMap(map: URLSearchParams | Headers, item: any): any {\n  for (let key in item) {\n    if (Array.isArray(item[key])) {\n      for (let i = 0; i < item[key].length; i++) {\n        map.append(key, item[key][i])\n      }\n    } else {\n      map.append(key, item[key])\n    }\n  }\n\n  return map\n}\n\n/**\n * UUID generator https://gist.github.com/jed/982883\n */\nexport function uuid(a: any = '', b: any = '') {\n  for (; a++ < 36; b += a * 51 & 52 ? (\n    a ^ 15 ? 8 ^ Math.random() * (a ^ 20 ? 16 : 4) : 4\n  ).toString(16) : '-') {\n    //\n  }\n  return b\n}\n","import {ErrorResponse} from './interfaces'\nimport * as superagent from 'superagent'\nimport {Stream, fromPromise} from 'most'\nimport {create} from '@most/create'\n\nexport function fetch(\n  input: string|Request,\n  init?: RequestInit,\n  abortCallback?: (req: Request) => void\n): Stream<any> {\n\n  if (!(input instanceof Request)) {\n    input = new Request(input, init)\n  }\n\n  let req = superagent[input.method.toLowerCase()](input.url)\n\n  for (let header of input.headers) {\n    req.set(header[0], header[1])\n  }\n\n  return fromPromise(input.text())\n  .flatMap(body => {\n    req.send(body)\n\n    return create((add, end, error) => {\n      req.end(function(err: any, res: any) {\n        if (err) {\n          let response = new Response(err, res) as ErrorResponse\n          response.message = response.statusText\n          return error(response)\n        }\n\n        if (res.noContent === true) {\n          add(new Response())\n          return end()\n        }\n\n        res.url = (input as Request).url\n        let response = new Response(res.text, res)\n\n        add(response)\n        end()\n      })\n\n      return function abort() {\n        req.abort()\n        abortCallback(req)\n      }\n    })\n  })\n}\n","import {\n  RequestInterceptor,\n  ResponseInterceptor,\n  ErrorInterceptor\n} from './interfaces'\nimport { RxRestItem } from './index'\nimport { BodyParam } from './interfaces'\nimport { objectToMap } from './utils'\nimport { fetch } from './fetch';\n\nexport interface RequestBodyHandler<T> {\n  (body: BodyParam<T>): FormData|URLSearchParams|Body|Blob|undefined|string|Promise<any>\n}\n\nexport interface ResponseBodyHandler {\n  (body: Response): Promise<any>\n}\n\n/**\n * RxRestConfiguration\n */\nexport class RxRestConfiguration {\n  private $baseURL: string\n  private $headers: Headers = new Headers()\n  private $queryParams: URLSearchParams = new URLSearchParams()\n  public identifier: string = 'id'\n  public requestInterceptors: RequestInterceptor[] = []\n  public responseInterceptors: ResponseInterceptor[] = []\n  public errorInterceptors: ErrorInterceptor[] = []\n  public fetch: any\n  public abortCallback: (req: Request) => void = () => null\n  public uuid: boolean = false\n\n  constructor() {\n      this.fetch = fetch\n  }\n\n  /**\n   * requestBodyHandler\n   * JSONify the body if it's an `RxRestItem` or an `Object`\n   *\n   * @param {FormData|URLSearchParams|Body|Blob|undefined} body\n   * @returns {any}\n   */\n  _requestBodyHandler(body: FormData|URLSearchParams|Body|Blob|undefined):\n    FormData|URLSearchParams|Body|Blob|undefined|string|Promise<any> {\n    if (!body) {\n      return undefined\n    }\n\n    if (body instanceof FormData || body instanceof URLSearchParams) {\n      return body\n    }\n\n    return body instanceof RxRestItem ? body.json() : JSON.stringify(body)\n  }\n\n  /**\n   * responseBodyHandler\n   * transforms the response to a json object\n   *\n   * @param {Response} body\n   * @reject when response is an error\n   * @returns {Promise<any>}\n   */\n  _responseBodyHandler(body: Response): Promise<{body: any, metadata: any}> {\n    return body.text()\n    .then(text => {\n      return {body: text ? JSON.parse(text) : null, metadata: null}\n    })\n  }\n\n  get responseBodyHandler(): ResponseBodyHandler {\n    return this._responseBodyHandler\n  }\n\n  set responseBodyHandler(responseBodyHandler: ResponseBodyHandler) {\n    this._responseBodyHandler = responseBodyHandler\n  }\n\n  get requestBodyHandler(): RequestBodyHandler<any> {\n    return this._requestBodyHandler\n  }\n\n  set requestBodyHandler(requestBodyHandler: RequestBodyHandler<any>) {\n    this._requestBodyHandler = requestBodyHandler\n  }\n\n  /**\n   * set baseURL\n   *\n   * @param {String} base\n   * @returns\n   */\n  set baseURL(base: string) {\n    if (base.charAt(base.length - 1) !== '/') {\n      base += '/'\n    }\n\n    this.$baseURL = base\n  }\n\n  /**\n   * get baseURL\n   *\n   * @returns {string}\n   */\n  get baseURL(): string {\n    return this.$baseURL\n  }\n\n  /**\n   * Set global query params\n   * @param {Object|URLSearchParams} params\n   */\n  set queryParams(params: any) {\n    if (params instanceof URLSearchParams) {\n      this.$queryParams = params\n      return\n    }\n\n    if (typeof params === 'string') {\n      this.$queryParams = new URLSearchParams(params)\n      return\n    }\n\n    this.$queryParams = objectToMap(new URLSearchParams(), params)\n  }\n\n  /**\n   * Get global query params\n   * @return {URLSearchParams}\n   */\n  get queryParams(): any {\n    return this.$queryParams\n  }\n\n  /**\n   * set global headers\n   * @param {Object|Headers} params\n   */\n  set headers(params: any) {\n     if (params instanceof Headers) {\n      this.$headers = params\n      return\n    }\n\n    this.$headers = objectToMap(new Headers(), params)\n }\n\n  /**\n   * Get global headers\n   * @return Headers\n   */\n  get headers(): any {\n    return this.$headers\n  }\n}\n","import { RxRestConfiguration } from './RxRestConfiguration'\nimport {\n  RequestInterceptor,\n  ResponseInterceptor,\n  ErrorInterceptor,\n  ErrorResponse,\n  BodyParam\n} from './interfaces'\nimport { RxRestCollection, RxRestItem } from './index'\nimport { Stream, throwError, of } from 'most'\nimport { create } from '@most/create'\nimport { objectToMap, uuid } from './utils'\n\nconst fromPromise = function(promise: Promise<any>) {\n  return create((add, end, error) => {\n    promise\n    .then((v) => {\n      add(v)\n      end()\n    })\n    .catch(error)\n  })\n}\n\nexport class RxRest<F, T> {\n  protected $route: string[]\n  $fromServer: boolean = false\n  $asIterable: boolean = false\n  $queryParams: URLSearchParams = new URLSearchParams()\n  $headers: Headers = new Headers()\n  config: RxRestConfiguration\n  $metadata: any\n  $pristine: boolean = true\n  $uuid?: string;\n\n  /**\n   * constructor\n   *\n   * @param {String} [route] the resource route\n   */\n  constructor(\n    config: RxRestConfiguration = new RxRestConfiguration(),\n    route?: string[],\n    metadata?: any\n  ) {\n    this.$route = route === undefined ? [] : [...route]\n    this.config = config\n    this.$metadata = metadata\n    if (config.uuid) {\n      this.$uuid = uuid()\n    }\n  }\n\n  protected addRoute(route: string): void {\n    this.$route.push.apply(this.$route, route.split('/'))\n  }\n\n  /**\n   * one\n   *\n   * @param {String} route\n   * @param {any} id\n   * @returns {RxRestItem}\n   */\n  one<T>(route: string, id?: any): RxRestItem<T> {\n    this.addRoute(route)\n    let o = {} as T\n    if (id) {\n      o[this.config.identifier] = id\n    }\n\n    return new RxRestItem<T>(this.$route, o, this.config)\n  }\n\n  /**\n   * all\n   *\n   * @param {String} route\n   * @param {boolean} asIterable - forces the next request to return an Observable<Array>\n   *                               instead of emitting multiple events\n   * @returns {RxRestCollection}\n   */\n  all<T>(route: string, asIterable: boolean = false): RxRestCollection<T> {\n    this.addRoute(route)\n    return new RxRestCollection<T>(this.$route, undefined, this.config, null, asIterable)\n  }\n\n  /**\n   * asIterable - forces the next request to return an Observable<Array>\n   * instead of emitting multiple events\n   *\n   * @returns {self}\n   */\n  asIterable(): this {\n    this.$asIterable = true\n    return this\n  }\n\n  /**\n   * fromObject\n   *\n   * @param {String} route\n   * @param {Object|Object[]} element\n   * @returns {RxRestItem|RxRestCollection}\n   */\n  fromObject<T>(route: string, element: T|T[]): RxRestItem<T>|RxRestCollection<T> {\n    this.addRoute(route)\n    if (Array.isArray(element)) {\n      return new RxRestCollection<T>(this.$route, element, this.config)\n    }\n\n    return new RxRestItem<T>(this.$route, element, this.config)\n  }\n\n  /**\n   * @access private\n   * @param {BodyParam} body\n   * @return {BodyParam|RxRestItem}\n   */\n  protected withBody(body: BodyParam<T>) {\n    return body ? body : this\n  }\n\n  /**\n   * post\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  post(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('POST', this.withBody(body))\n  }\n\n  /**\n   * remove\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  remove(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('DELETE')\n  }\n\n  /**\n   * get\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  get(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('GET')\n  }\n\n  /**\n   * put\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  put(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('PUT', this.withBody(body))\n  }\n\n  /**\n   * patch\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  patch(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('PATCH', this.withBody(body))\n  }\n\n  /**\n   * head\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  head(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('HEAD')\n  }\n\n  /**\n   * trace\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  trace(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('TRACE')\n  }\n\n  /**\n   * options\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  options(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<F> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('OPTIONS')\n  }\n\n  /**\n   * URL\n   *\n   * @returns {string}\n   */\n  get URL(): string {\n    return `${this.config.baseURL}${this.$route.join('/')}`\n  }\n\n  /**\n   * set local query params\n   * @param {Object|URLSearchParams} params\n   */\n  set queryParams(params: any) {\n    if (!params) {\n      return\n    }\n\n    if (params instanceof URLSearchParams) {\n      this.$queryParams = params\n      return\n    }\n\n    this.$queryParams = objectToMap(new URLSearchParams(), params)\n  }\n\n  /**\n   * Sets local query params useful to add params to a custom request\n   * @param {Object|URLSearchParams}\n   * @return this\n   */\n  setQueryParams(params: any): this {\n    this.queryParams = params\n    return this\n  }\n\n  /**\n   * Sets local headers useful to add headers to a custom request\n   * @param {Object|URLSearchParams}\n   * @return this\n   */\n  setHeaders(params: any): this {\n    this.headers = params\n    return this\n  }\n\n  /**\n   * Get local query params\n   * @return URLSearchParams\n   */\n  get queryParams(): any {\n    return this.$queryParams\n  }\n\n  /**\n   * Get request query params\n   * Combine local and global query params\n   * Local query params are overriding global params\n   * @return {String}\n   */\n  get requestQueryParams(): string {\n    let params = new URLSearchParams()\n\n    for (let param of this.config.queryParams) {\n      params.append(param[0], param[1])\n    }\n\n    for (let param of this.queryParams) {\n      params.append(param[0], param[1])\n    }\n\n    let str = params.toString()\n\n    if (str.length) {\n      return '?' + str\n    }\n\n    return ''\n  }\n\n  /**\n   * Set local headers\n   * @param {Object|Headers} params\n   */\n  set headers(params: any) {\n    if (!params) {\n      return\n    }\n\n     if (params instanceof Headers) {\n      this.$headers = params\n      return\n    }\n\n    this.$headers = objectToMap(new Headers(), params)\n }\n\n  /**\n   * Get local headers\n   * @return Headers\n   */\n  get headers(): any {\n    return this.$headers\n  }\n\n  /**\n   * get request Headers\n   * Combine local and global headers\n   * Local headers are overriding global headers\n   *\n   * @returns {Headers}\n   */\n  get requestHeaders(): Headers {\n    let headers = new Headers()\n\n    for (let header of this.headers) {\n      headers.append(header[0], header[1])\n    }\n\n    for (let header of this.config.headers) {\n      headers.append(header[0], header[1])\n    }\n\n    return headers\n  }\n\n  /**\n   * expandInterceptors\n   *\n   * @param {RequestInterceptor[]|ResponseInterceptor[]|ErrorInterceptor[]} interceptors\n   * @returns {Stream<any>} fn\n   */\n  private expandInterceptors(\n    interceptors: RequestInterceptor[]|ResponseInterceptor[]|ErrorInterceptor[]\n  ) {\n    return function(origin: any): Stream<any> {\n      return (<any>interceptors).reduce(\n        (obs: Stream<any>, interceptor: any) =>\n          obs.concatMap(value => {\n            let result = interceptor(value)\n            if (result === undefined) {\n              return of(value)\n            }\n\n            if (result instanceof Promise) {\n              return fromPromise(result)\n            }\n\n            if (result instanceof Stream) {\n              return result\n            }\n\n            return of(result)\n          }),\n        of(origin)\n      )\n    }\n  }\n\n  /**\n   * request\n   *\n   * @param {string} method\n   * @param {RxRestItem|FormData|URLSearchParams|Body|Blob|undefined|Object} [body]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  request(method: string, body?: BodyParam<T>): Stream<F> {\n    let requestOptions = {\n      method: method,\n      headers: <Headers> this.requestHeaders,\n      body: this.config.requestBodyHandler(body)\n    }\n\n    let request = new Request(this.URL + this.requestQueryParams, requestOptions);\n\n    let stream = <Stream<F>> of(request)\n    .flatMap(this.expandInterceptors(this.config.requestInterceptors))\n    .flatMap(request => this.config.fetch(request, null, this.config.abortCallback))\n    .flatMap(this.expandInterceptors(this.config.responseInterceptors))\n    .flatMap(body => fromPromise(this.config.responseBodyHandler(body)))\n    .flatMap(({body, metadata}) => {\n      if (!Array.isArray(body)) {\n        let item: RxRestItem<T>\n        if (this instanceof RxRestItem) {\n          item = this\n          item.element = body as T\n          item.$metadata = metadata\n        } else {\n          item = new RxRestItem<T>(this.$route, body, this.config, metadata)\n        }\n\n        item.$fromServer = true\n        item.$pristine = true\n\n        return create((add, end, error) => {\n          add(item)\n          end(item)\n        })\n      }\n\n      let collection = new RxRestCollection<T>(this.$route, body.map((e: T) => {\n        let item = new RxRestItem<T>(this.$route, e, this.config, metadata)\n        item.$fromServer = true\n        item.$pristine = true\n        return item\n      }), this.config, metadata)\n\n      collection.$pristine = true\n\n      return create((add, end, error) => {\n        if (this.$asIterable) {\n          add(collection)\n        } else {\n          for (let item of collection) {\n            add(item)\n          }\n        }\n\n        end(collection)\n      })\n    })\n    .recoverWith(body => {\n      return of(body)\n      .flatMap(this.expandInterceptors(this.config.errorInterceptors))\n      .flatMap((body: ErrorResponse) => throwError(body))\n    })\n\n    return stream\n  }\n}\n","import { Stream } from 'most'\nimport { RxRestProxyHandler } from './RxRestProxyHandler'\nimport { RxRest as AbstractRxRest } from './RxRest'\nimport { RxRestConfiguration } from './RxRestConfiguration';\n\nexport class RxRestItem<T> extends AbstractRxRest<RxRestItem<T> & T, T> {\n  $element: T = {} as T;\n\n  /**\n   * constructor\n   *\n   * @param {string[]} route\n   * @param {T} [element]\n   * @return {Proxy}\n   */\n  constructor(route: string[], element?: T, config?: RxRestConfiguration, metadata?: any) {\n    super(config, route, metadata)\n\n    if (element !== undefined) {\n      this.element = element\n    }\n\n    const proxy = new Proxy(this.$element, new RxRestProxyHandler<RxRestItem<T>, T>(this))\n\n    return <RxRestItem<T> & T> proxy\n  }\n\n  /**\n   * save - POST or PUT according to $fromServer value\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  save(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request(this.$fromServer === true ? 'PUT' : 'POST', this)\n  }\n\n  /**\n   * set element\n   *\n   * @param {T} element\n   */\n  set element(element: T) {\n    for (let i in element) {\n      if (i === this.config.identifier && !this.$element[this.config.identifier]) {\n        this.$route.push('' + element[i])\n      }\n\n      this.$element[i] = element[i]\n    }\n  }\n\n  /**\n   * get element\n   *\n   * @return {T}\n   */\n  get element(): T {\n    return this.$element\n  }\n\n  /**\n   * get plain object\n   *\n   * @return {T}\n   */\n  plain(): T {\n    return this.element\n  }\n\n  /**\n   * Get json string\n   * @return {string}\n   */\n  json(): string {\n    return JSON.stringify(this.plain())\n  }\n\n  /**\n   * Clone\n   * @return {RxRestItem<T>}\n   */\n  clone(): RxRestItem<T> & T {\n    let route = this.$route\n\n    if (this.$element[this.config.identifier]) {\n      route = route.slice(0, this.$route.length - 1)\n    }\n\n    let clone = new RxRestItem(route, this.$element, this.config)\n    clone.$fromServer = this.$fromServer\n    return clone as RxRestItem<T> & T\n  }\n}\n\nexport class RxRestCollection<T> extends AbstractRxRest<RxRestCollection<T> & T[] & T, T>\n  implements Iterable<RxRestItem<T>> {\n  length: number;\n  $elements: RxRestItem<T>[] = [];\n  [index: number]: RxRestItem<T>;\n\n  /**\n   * constructor\n   *\n   * @param {string[]} route\n   * @param {T[]|RxRestItem<T>[]]} [elements]\n   * @return {Proxy}\n   */\n  constructor(\n    route: string[],\n    elements?: T[]|RxRestItem<T>[],\n    config?: RxRestConfiguration,\n    metadata?: any,\n    asIterable: boolean = false\n  ) {\n    super(config, route, metadata)\n\n    if (elements !== undefined) {\n      this.elements = (elements as any).map((e: any) =>\n        e instanceof RxRestItem ? e.clone() : new RxRestItem(this.$route, e)\n      )\n    }\n\n    this.$asIterable = asIterable\n\n    const proxy = new Proxy(this.$elements, new RxRestProxyHandler<RxRestCollection<T>, T>(this))\n\n    return <RxRestCollection<T> & T[]> proxy\n  }\n\n  [Symbol.iterator]() {\n    let index = 0\n    let elements = this.$elements\n\n    return {\n      next(): IteratorResult<RxRestItem<T>> {\n        return index < elements.length ?\n          {value: elements[index++], done: false} : {value: undefined, done: true}\n      }\n    }\n  }\n\n  /**\n   * getList - fetch a collection\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  getList(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('GET')\n  }\n\n  /**\n   * set elements\n   *\n   * @param {T[]} elements\n   */\n  set elements(elements: RxRestItem<T>[]) {\n    this.$elements = elements\n    this.length = elements.length\n  }\n\n  /**\n   * get elements\n   * @return {RxRestItem<T>[]}\n   */\n  get elements(): RxRestItem<T>[] {\n    return this.$elements\n  }\n\n  /**\n   * plain\n   *\n   * @returns {T[]}\n   */\n  plain(): T[] {\n    return this.elements.map(e => e.plain())\n  }\n\n  /**\n   * json\n   *\n   * @returns {String}\n   */\n  json(): string {\n    return JSON.stringify(this.plain())\n  }\n\n  /**\n   * clone\n   *\n   * @returns {RxRestCollection}\n   */\n  clone(): RxRestCollection<T> & T[] {\n    return new RxRestCollection<T>(\n      this.$route, this.$elements, this.config\n    ) as RxRestCollection<T> & T[]\n  }\n}\n\nexport class RxRest {\n  constructor(private config: RxRestConfiguration) {\n  }\n\n  one<T>(route: string, id?: any): RxRestItem<T> & T {\n    let r = new AbstractRxRest(this.config)\n    return r.one.call(r, route, id)\n  }\n\n  all<T>(route: string, asIterable: boolean = false): RxRestCollection<T> & T[] {\n    let r = new AbstractRxRest(this.config)\n    return r.all.call(r, route, asIterable)\n  }\n\n  fromObject<T>(route: string, element: T|T[]): (RxRestItem<T> & T) | (RxRestCollection<T> & T[]) {\n    let r = new AbstractRxRest(this.config)\n    return r.fromObject.call(r, route, element)\n  }\n}\n\nexport { RxRestConfiguration }\n"],"names":["target","$instance","$internal","concat","Object","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","p","attributes","indexOf","defineProperty","value","receiver","$pristine","map","item","key","Array","isArray","i","length","append","a","b","Math","random","toString","input","init","abortCallback","Request","req","superagent","method","toLowerCase","url","headers","header","set","fromPromise","text","flatMap","send","body","create","add","end","error","err","res","response","Response","message","statusText","noContent","abort","Headers","URLSearchParams","fetch","undefined","FormData","RxRestItem","json","JSON","stringify","then","parse","metadata","_responseBodyHandler","responseBodyHandler","_requestBodyHandler","requestBodyHandler","base","charAt","$baseURL","params","$queryParams","objectToMap","$headers","promise","v","catch","config","RxRestConfiguration","route","$route","$metadata","uuid","$uuid","push","apply","split","id","addRoute","o","identifier","asIterable","RxRestCollection","$asIterable","element","queryParams","request","withBody","interceptors","origin","reduce","obs","interceptor","concatMap","result","of","Promise","Stream","requestOptions","requestHeaders","URL","requestQueryParams","stream","expandInterceptors","requestInterceptors","responseInterceptors","$fromServer","collection","e","recoverWith","errorInterceptors","throwError","baseURL","join","param","str","proxy","Proxy","$element","RxRestProxyHandler","plain","slice","clone","AbstractRxRest","elements","$elements","Symbol","iterator","index","done","r","one","call","all","fromObject"],"mappings":"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"}