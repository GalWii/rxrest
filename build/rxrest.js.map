{"version":3,"file":"rxrest.js","sources":["../src/RxRestProxyHandler.ts","../src/utils.ts","../src/fetch.ts","../src/RxRestConfiguration.ts","../src/RxRest.ts","../src/index.ts"],"sourcesContent":["import {RxRestCollection, RxRestItem} from './index'\nimport {RxRest} from './RxRest'\n\nexport class RxRestProxyHandler<T> implements ProxyHandler<RxRest<T>> {\n  private $internal: PropertyKey[] = [];\n  private $instance: RxRestItem<T> | RxRestCollection<T>;\n\n  constructor(target: RxRestItem<T> | RxRestCollection<T>) {\n    this.$instance = target\n    do {\n      this.$internal = this.$internal.concat(\n        Object.getOwnPropertyNames(target), Object.getOwnPropertySymbols(target)\n      )\n    } while (target = Object.getPrototypeOf(target))\n  }\n\n  getPrototypeOf(target: any) {\n    return Object.getPrototypeOf(this.$instance)\n  }\n\n  defineProperty(target: any, p: PropertyKey, attributes: PropertyDescriptor): boolean {\n    if (~this.$internal.indexOf(p)) {\n      return true\n    }\n\n    Object.defineProperty(target, p, attributes)\n    return true\n  }\n\n  deleteProperty(target: any, p: PropertyKey): boolean {\n    return delete target[p]\n  }\n\n  set(target: any, p: PropertyKey, value: any, receiver: any): boolean {\n\n    if (~this.$internal.indexOf(p)) {\n      this.$instance[p] = value\n      return true\n    }\n\n    target[p] = value\n    return true\n  }\n\n  get(target: any, p: PropertyKey, receiver: any): any {\n    if (~this.$internal.indexOf(p)) {\n      return this.$instance[p]\n    }\n\n    return target[p]\n  }\n}\n","export function objectToMap(map: URLSearchParams | Headers, item: any): any {\n  for (let key in item) {\n    if (Array.isArray(item[key])) {\n      for (let i = 0; i < item[key].length; i++) {\n        map.append(key, item[key][i])\n      }\n    } else {\n      map.append(key, item[key])\n    }\n  }\n\n  return map\n}\n","import {ErrorResponse} from './interfaces'\nimport * as superagent from 'superagent'\nimport {Stream, fromPromise} from 'most'\nimport {create} from '@most/create'\n\nexport function fetch(\n  input: string|Request,\n  init?: RequestInit,\n  abortCallback?: (req: Request) => void\n): Stream<any> {\n\n  if (!(input instanceof Request)) {\n    input = new Request(input, init)\n  }\n\n  let req = superagent[input.method.toLowerCase()](input.url)\n\n  for (let header of input.headers) {\n    req.set(header[0], header[1])\n  }\n\n  return fromPromise(input.text())\n  .flatMap(body => {\n    req.send(body)\n\n    return create((add, end, error) => {\n      req.end(function(err: any, res: any) {\n        if (err) {\n          let response = new Response(err, res) as ErrorResponse\n          response.message = response.statusText\n          return error(response)\n        }\n\n        if (res.noContent === true) {\n          add(new Response())\n          return end()\n        }\n\n        res.url = (input as Request).url\n        let response = new Response(res.text, res)\n\n        add(response)\n        end()\n      })\n\n      return function abort() {\n        req.abort()\n        abortCallback(req)\n      }\n    })\n  })\n}\n","import {\n  RequestInterceptor,\n  ResponseInterceptor,\n  ErrorInterceptor\n} from './interfaces'\nimport { RxRestItem } from './index'\nimport { BodyParam } from './interfaces'\nimport { objectToMap } from './utils'\nimport { fetch } from './fetch';\n\nexport interface RequestBodyHandler<T> {\n  (body: BodyParam<T>): FormData|URLSearchParams|Body|Blob|undefined|string|Promise<any>\n}\n\nexport interface ResponseBodyHandler {\n  (body: Response): Promise<any>\n}\n\n/**\n * RxRestConfiguration\n */\nexport class RxRestConfiguration {\n  private $baseURL: string\n  private $headers: Headers = new Headers()\n  private $queryParams: URLSearchParams = new URLSearchParams()\n  public identifier: string = 'id'\n  public requestInterceptors: RequestInterceptor[] = []\n  public responseInterceptors: ResponseInterceptor[] = []\n  public errorInterceptors: ErrorInterceptor[] = []\n  public fetch: any\n  public abortCallback: (req: Request) => void = () => null\n\n  constructor() {\n      this.fetch = fetch\n  }\n\n  /**\n   * requestBodyHandler\n   * JSONify the body if it's an `RxRestItem` or an `Object`\n   *\n   * @param {FormData|URLSearchParams|Body|Blob|undefined} body\n   * @returns {any}\n   */\n  _requestBodyHandler(body: FormData|URLSearchParams|Body|Blob|undefined):\n    FormData|URLSearchParams|Body|Blob|undefined|string|Promise<any> {\n    if (!body) {\n      return undefined\n    }\n\n    if (body instanceof FormData || body instanceof URLSearchParams) {\n      return body\n    }\n\n    return body instanceof RxRestItem ? body.json() : JSON.stringify(body)\n  }\n\n  /**\n   * responseBodyHandler\n   * transforms the response to a json object\n   *\n   * @param {Response} body\n   * @reject when response is an error\n   * @returns {Promise<any>}\n   */\n  _responseBodyHandler(body: Response): Promise<{body: any, metadata: any}> {\n    return body.text()\n    .then(text => {\n      return {body: text ? JSON.parse(text) : null, metadata: null}\n    })\n  }\n\n  get responseBodyHandler(): ResponseBodyHandler {\n    return this._responseBodyHandler\n  }\n\n  set responseBodyHandler(responseBodyHandler: ResponseBodyHandler) {\n    this._responseBodyHandler = responseBodyHandler\n  }\n\n  get requestBodyHandler(): RequestBodyHandler<any> {\n    return this._requestBodyHandler\n  }\n\n  set requestBodyHandler(requestBodyHandler: RequestBodyHandler<any>) {\n    this._requestBodyHandler = requestBodyHandler\n  }\n\n  /**\n   * set baseURL\n   *\n   * @param {String} base\n   * @returns\n   */\n  set baseURL(base: string) {\n    if (base.charAt(base.length - 1) !== '/') {\n      base += '/'\n    }\n\n    this.$baseURL = base\n  }\n\n  /**\n   * get baseURL\n   *\n   * @returns {string}\n   */\n  get baseURL(): string {\n    return this.$baseURL\n  }\n\n  /**\n   * Set global query params\n   * @param {Object|URLSearchParams} params\n   */\n  set queryParams(params: any) {\n    if (params instanceof URLSearchParams) {\n      this.$queryParams = params\n      return\n    }\n\n    if (typeof params === 'string') {\n      this.$queryParams = new URLSearchParams(params)\n      return\n    }\n\n    this.$queryParams = objectToMap(new URLSearchParams(), params)\n  }\n\n  /**\n   * Get global query params\n   * @return {URLSearchParams}\n   */\n  get queryParams(): any {\n    return this.$queryParams\n  }\n\n  /**\n   * set global headers\n   * @param {Object|Headers} params\n   */\n  set headers(params: any) {\n     if (params instanceof Headers) {\n      this.$headers = params\n      return\n    }\n\n    this.$headers = objectToMap(new Headers(), params)\n }\n\n  /**\n   * Get global headers\n   * @return Headers\n   */\n  get headers(): any {\n    return this.$headers\n  }\n\n}\n","import { RxRestConfiguration } from './RxRestConfiguration';\nimport {\n  RequestInterceptor,\n  ResponseInterceptor,\n  ErrorInterceptor,\n  ErrorResponse,\n  BodyParam\n} from './interfaces';\nimport { RxRestCollection, RxRestItem } from './index'\nimport { Stream, throwError, of } from 'most'\nimport { create } from '@most/create'\nimport { objectToMap } from './utils';\n\nconst fromPromise = function(promise: Promise<any>) {\n  return create((add, end, error) => {\n    promise\n    .then((v) => {\n      add(v)\n      end()\n    })\n    .catch(error)\n  })\n}\n\nexport class RxRest<T> {\n  protected $route: string[]\n  $fromServer: boolean = false\n  $asIterable: boolean = false\n  $queryParams: URLSearchParams = new URLSearchParams()\n  $headers: Headers = new Headers()\n  config: RxRestConfiguration\n  $metadata: any\n\n  /**\n   * constructor\n   *\n   * @param {String} [route] the resource route\n   */\n  constructor(\n    config: RxRestConfiguration = new RxRestConfiguration(),\n    route?: string[],\n    metadata?: any\n  ) {\n    this.$route = route === undefined ? [] : [...route]\n    this.config = config\n    this.$metadata = metadata\n  }\n\n  protected addRoute(route: string): void {\n    this.$route.push.apply(this.$route, route.split('/'))\n  }\n\n  /**\n   * one\n   *\n   * @param {String} route\n   * @param {any} id\n   * @returns {RxRestItem}\n   */\n  one<T>(route: string, id?: any): RxRestItem<T> {\n    this.addRoute(route)\n    let o = {} as T\n    if (id) {\n      o[this.config.identifier] = id\n    }\n\n    return new RxRestItem<T>(this.$route, o, this.config)\n  }\n\n  /**\n   * all\n   *\n   * @param {String} route\n   * @param {boolean} asIterable - forces the next request to return an Observable<Array>\n   *                               instead of emitting multiple events\n   * @returns {RxRestCollection}\n   */\n  all<T>(route: string, asIterable: boolean = false): RxRestCollection<T> {\n    this.addRoute(route)\n    return new RxRestCollection<T>(this.$route, undefined, this.config, null, asIterable)\n  }\n\n  /**\n   * asIterable - forces the next request to return an Observable<Array>\n   * instead of emitting multiple events\n   *\n   * @returns {self}\n   */\n  asIterable(): this {\n    this.$asIterable = true\n    return this\n  }\n\n  /**\n   * fromObject\n   *\n   * @param {String} route\n   * @param {Object|Object[]} element\n   * @returns {RxRestItem|RxRestCollection}\n   */\n  fromObject<T>(route: string, element: T|T[]): RxRestItem<T>|RxRestCollection<T> {\n    this.addRoute(route)\n    if (Array.isArray(element)) {\n      return new RxRestCollection<T>(this.$route, element, this.config)\n    }\n\n    return new RxRestItem<T>(this.$route, element, this.config)\n  }\n\n  /**\n   * @access private\n   * @param {BodyParam} body\n   * @return {BodyParam|RxRestItem}\n   */\n  protected withBody(body: BodyParam<T>) {\n    return body ? body : this\n  }\n\n  /**\n   * post\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  post(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('POST', this.withBody(body))\n  }\n\n  /**\n   * remove\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  remove(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('DELETE')\n  }\n\n  /**\n   * get\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  get(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('GET')\n  }\n\n  /**\n   * put\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  put(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('PUT', this.withBody(body))\n  }\n\n  /**\n   * patch\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  patch(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('PATCH', this.withBody(body))\n  }\n\n  /**\n   * head\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  head(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('HEAD')\n  }\n\n  /**\n   * trace\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  trace(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('TRACE')\n  }\n\n  /**\n   * options\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  options(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('OPTIONS')\n  }\n\n  /**\n   * URL\n   *\n   * @returns {string}\n   */\n  get URL(): string {\n    return `${this.config.baseURL}${this.$route.join('/')}`\n  }\n\n  /**\n   * set local query params\n   * @param {Object|URLSearchParams} params\n   */\n  set queryParams(params: any) {\n    if (!params) {\n      return\n    }\n\n    if (params instanceof URLSearchParams) {\n      this.$queryParams = params\n      return\n    }\n\n    this.$queryParams = objectToMap(new URLSearchParams(), params)\n  }\n\n  /**\n   * Sets local query params useful to add params to a custom request\n   * @param {Object|URLSearchParams}\n   * @return this\n   */\n  setQueryParams(params: any): RxRest<T> {\n    this.queryParams = params\n    return this\n  }\n\n  /**\n   * Sets local headers useful to add headers to a custom request\n   * @param {Object|URLSearchParams}\n   * @return this\n   */\n  setHeaders(params: any): RxRest<T> {\n    this.headers = params\n    return this\n  }\n\n  /**\n   * Get local query params\n   * @return URLSearchParams\n   */\n  get queryParams(): any {\n    return this.$queryParams\n  }\n\n  /**\n   * Get request query params\n   * Combine local and global query params\n   * Local query params are overriding global params\n   * @return {String}\n   */\n  get requestQueryParams(): string {\n    let params = new URLSearchParams()\n\n    for (let param of this.config.queryParams) {\n      params.append(param[0], param[1])\n    }\n\n    for (let param of this.queryParams) {\n      params.append(param[0], param[1])\n    }\n\n    let str = params.toString()\n\n    if (str.length) {\n      return '?' + str\n    }\n\n    return ''\n  }\n\n  /**\n   * Set local headers\n   * @param {Object|Headers} params\n   */\n  set headers(params: any) {\n    if (!params) {\n      return\n    }\n\n     if (params instanceof Headers) {\n      this.$headers = params\n      return\n    }\n\n    this.$headers = objectToMap(new Headers(), params)\n }\n\n  /**\n   * Get local headers\n   * @return Headers\n   */\n  get headers(): any {\n    return this.$headers\n  }\n\n  /**\n   * get request Headers\n   * Combine local and global headers\n   * Local headers are overriding global headers\n   *\n   * @returns {Headers}\n   */\n  get requestHeaders(): Headers {\n    let headers = new Headers()\n\n    for (let header of this.headers) {\n      headers.append(header[0], header[1])\n    }\n\n    for (let header of this.config.headers) {\n      headers.append(header[0], header[1])\n    }\n\n    return headers\n  }\n\n  /**\n   * expandInterceptors\n   *\n   * @param {RequestInterceptor[]|ResponseInterceptor[]|ErrorInterceptor[]} interceptors\n   * @returns {Stream<any>} fn\n   */\n  private expandInterceptors(\n    interceptors: RequestInterceptor[]|ResponseInterceptor[]|ErrorInterceptor[]\n  ) {\n    return function(origin: any): Stream<any> {\n      return (<any>interceptors).reduce(\n        (obs: Stream<any>, interceptor: any) =>\n          obs.concatMap(value => {\n            let result = interceptor(value)\n            if (result === undefined) {\n              return of(value)\n            }\n\n            if (result instanceof Promise) {\n              return fromPromise(result)\n            }\n\n            if (result instanceof Stream) {\n              return result\n            }\n\n            return of(result)\n          }),\n        of(origin)\n      )\n    }\n  }\n\n  /**\n   * request\n   *\n   * @param {string} method\n   * @param {RxRestItem|FormData|URLSearchParams|Body|Blob|undefined|Object} [body]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  request(method: string, body?: BodyParam<T>): Stream<RxRestItem<T> & T> {\n    let requestOptions = {\n      method: method,\n      headers: <Headers> this.requestHeaders,\n      body: this.config.requestBodyHandler(body)\n    }\n\n    let request = new Request(this.URL + this.requestQueryParams, requestOptions);\n\n    let stream = <Stream<RxRestItem<T> & T>> of(request)\n    .flatMap(this.expandInterceptors(this.config.requestInterceptors))\n    .flatMap(request => this.config.fetch(request, null, this.config.abortCallback))\n    .flatMap(this.expandInterceptors(this.config.responseInterceptors))\n    .flatMap(body => fromPromise(this.config.responseBodyHandler(body)))\n    .flatMap(({body, metadata}) => {\n      if (!Array.isArray(body)) {\n        let item: RxRestItem<T>\n        if (this instanceof RxRestItem) {\n          item = this\n          item.element = body as T\n          item.$metadata = metadata\n        } else {\n          item = new RxRestItem(this.$route, body as T, this.config, metadata)\n        }\n\n        item.$fromServer = true\n\n        return create((add, end, error) => {\n          add(item)\n          end(item)\n        })\n      }\n\n      let collection = new RxRestCollection<T>(this.$route, body.map((e: T) => {\n        let item = new RxRestItem(this.$route, e, this.config, metadata)\n        item.$fromServer = true\n        return item\n      }), this.config, metadata)\n\n      return create((add, end, error) => {\n        if (this.$asIterable) {\n          add(collection)\n        } else {\n          for (let item of collection) {\n            add(item)\n          }\n        }\n\n        end(collection)\n      })\n    })\n    .recoverWith(body => {\n      return of(body)\n      .flatMap(this.expandInterceptors(this.config.errorInterceptors))\n      .flatMap((body: ErrorResponse) => throwError(body))\n    })\n\n    return stream\n  }\n}\n","import { Stream } from 'most'\nimport { RxRestProxyHandler } from './RxRestProxyHandler'\nimport { RxRest as AbstractRxRest } from './RxRest'\nimport { RxRestConfiguration } from './RxRestConfiguration';\n\nexport class RxRestItem<T> extends AbstractRxRest<T> {\n  $element: T = {} as T;\n\n  /**\n   * constructor\n   *\n   * @param {string[]} route\n   * @param {T} [element]\n   * @return {Proxy}\n   */\n  constructor(route: string[], element?: T, config?: RxRestConfiguration, metadata?: any) {\n    super(config, route, metadata)\n\n    if (element !== undefined) {\n      this.element = element\n    }\n\n    const proxy = new Proxy(this.$element, new RxRestProxyHandler<T>(this))\n\n    return <RxRestItem<T> & T> proxy\n  }\n\n  /**\n   * save - POST or PUT according to $fromServer value\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  save(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request(this.$fromServer === true ? 'PUT' : 'POST', this)\n  }\n\n  /**\n   * set element\n   *\n   * @param {T} element\n   */\n  set element(element: T) {\n    for (let i in element) {\n      if (i === this.config.identifier && !this.$element[this.config.identifier]) {\n        this.$route.push('' + element[i])\n      }\n\n      this.$element[i] = element[i]\n    }\n  }\n\n  /**\n   * get element\n   *\n   * @return {T}\n   */\n  get element(): T {\n    return this.$element\n  }\n\n  /**\n   * get plain object\n   *\n   * @return {T}\n   */\n  plain(): T {\n    return this.element\n  }\n\n  /**\n   * Get json string\n   * @return {string}\n   */\n  json(): string {\n    return JSON.stringify(this.plain())\n  }\n\n  /**\n   * Clone\n   * @return {RxRestItem<T>}\n   */\n  clone(): RxRestItem<T> {\n    let route = this.$route\n\n    if (this.$element[this.config.identifier]) {\n      route = route.slice(0, this.$route.length - 1)\n    }\n\n    let clone = new RxRestItem(route, this.$element, this.config)\n    clone.$fromServer = this.$fromServer\n    return clone\n  }\n}\n\nexport class RxRestCollection<T> extends AbstractRxRest<T>\n  implements Iterable<RxRestItem<T>>, RxRestCollection<T> {\n  length: number;\n  $elements: RxRestItem<T>[] = [];\n  [index: number]: RxRestItem<T>;\n\n  /**\n   * constructor\n   *\n   * @param {string[]} route\n   * @param {T[]|RxRestItem<T>[]]} [elements]\n   * @return {Proxy}\n   */\n  constructor(\n    route: string[],\n    elements?: T[]|RxRestItem<T>[],\n    config?: RxRestConfiguration,\n    metadata?: any,\n    asIterable: boolean = false\n  ) {\n    super(config, route, metadata)\n\n    if (elements !== undefined) {\n      this.elements = (elements as any).map((e: any) =>\n        e instanceof RxRestItem ? e.clone() : new RxRestItem(this.$route, e)\n      )\n    }\n\n    this.$asIterable = asIterable\n\n    const proxy = new Proxy(this.$elements, new RxRestProxyHandler<T>(this))\n\n    return <RxRestCollection<T> & T> proxy\n  }\n\n  [Symbol.iterator]() {\n    let index = 0\n    let elements = this.$elements\n\n    return {\n      next(): IteratorResult<RxRestItem<T>> {\n        return index < elements.length ?\n          {value: elements[index++], done: false} : {value: undefined, done: true}\n      }\n    }\n  }\n\n  /**\n   * getList - fetch a collection\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  getList(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('GET')\n  }\n\n  /**\n   * set elements\n   *\n   * @param {T[]} elements\n   */\n  set elements(elements: RxRestItem<T>[]) {\n    this.$elements = elements\n    this.length = elements.length\n  }\n\n  /**\n   * get elements\n   * @return {RxRestItem<T>[]}\n   */\n  get elements(): RxRestItem<T>[] {\n    return this.$elements\n  }\n\n  /**\n   * plain\n   *\n   * @returns {T[]}\n   */\n  plain(): T[] {\n    return this.elements.map(e => e.plain())\n  }\n\n  /**\n   * json\n   *\n   * @returns {String}\n   */\n  json(): string {\n    return JSON.stringify(this.plain())\n  }\n\n  /**\n   * clone\n   *\n   * @returns {RxRestCollection}\n   */\n  clone(): RxRestCollection<T> {\n    return new RxRestCollection<T>(this.$route, this.$elements, this.config)\n  }\n}\n\nexport class RxRest {\n  constructor(private config: RxRestConfiguration) {\n  }\n\n  one<T>(route: string, id?: any): RxRestItem<T> & T {\n    let r = new AbstractRxRest(this.config)\n    return r.one.call(r, route, id)\n  }\n\n  all<T>(route: string, asIterable: boolean = false): RxRestCollection<T> & T {\n    let r = new AbstractRxRest(this.config)\n    return r.all.call(r, route, asIterable)\n  }\n\n  fromObject<T>(route: string, element: T|T[]): (RxRestItem<T> & T) | (RxRestCollection<T> & T) {\n    let r = new AbstractRxRest(this.config)\n    return r.fromObject.call(r, route, element)\n  }\n}\n\nexport { RxRestConfiguration }\n"],"names":["target","$instance","$internal","concat","Object","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","p","attributes","indexOf","defineProperty","value","receiver","map","item","key","Array","isArray","i","length","append","input","init","abortCallback","Request","req","superagent","method","toLowerCase","url","headers","header","set","fromPromise","text","flatMap","send","body","create","add","end","error","err","res","response","Response","message","statusText","noContent","abort","Headers","URLSearchParams","fetch","undefined","FormData","RxRestItem","json","JSON","stringify","then","parse","metadata","_responseBodyHandler","responseBodyHandler","_requestBodyHandler","requestBodyHandler","base","charAt","$baseURL","params","$queryParams","objectToMap","$headers","promise","v","catch","config","RxRestConfiguration","route","$route","$metadata","push","apply","split","id","addRoute","o","identifier","asIterable","RxRestCollection","$asIterable","element","queryParams","request","withBody","interceptors","origin","reduce","obs","interceptor","concatMap","result","of","Promise","Stream","requestOptions","requestHeaders","URL","requestQueryParams","stream","expandInterceptors","requestInterceptors","responseInterceptors","$fromServer","collection","e","recoverWith","errorInterceptors","throwError","baseURL","join","param","str","toString","proxy","Proxy","$element","RxRestProxyHandler","plain","slice","clone","AbstractRxRest","elements","$elements","Symbol","iterator","index","done","r","one","call","all","fromObject"],"mappings":"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"}