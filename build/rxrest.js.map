{"version":3,"file":"rxrest.js","sources":["../src/RxRestProxyHandler.ts","../src/utils.ts","../src/fetch.ts","../src/RxRestConfiguration.ts","../src/RxRest.ts","../src/index.ts"],"sourcesContent":["import {RxRestCollection, RxRestItem} from './index'\nimport {RxRest} from './RxRest'\n\nexport class RxRestProxyHandler<T> implements ProxyHandler<RxRest<T>> {\n  private $internal: PropertyKey[] = [];\n  private $instance: RxRestItem<T> | RxRestCollection<T>;\n\n  constructor(target: RxRestItem<T> | RxRestCollection<T>) {\n    this.$instance = target\n    do {\n      this.$internal = this.$internal.concat(\n        Object.getOwnPropertyNames(target), Object.getOwnPropertySymbols(target)\n      )\n    } while (target = Object.getPrototypeOf(target))\n  }\n\n  getPrototypeOf(target: any) {\n    return Object.getPrototypeOf(this.$instance)\n  }\n\n  defineProperty(target: any, p: PropertyKey, attributes: PropertyDescriptor): boolean {\n    if (~this.$internal.indexOf(p)) {\n      return true\n    }\n\n    Object.defineProperty(target, p, attributes)\n    return true\n  }\n\n  deleteProperty(target: any, p: PropertyKey): boolean {\n    return delete target[p]\n  }\n\n  set(target: any, p: PropertyKey, value: any, receiver: any): boolean {\n\n    if (~this.$internal.indexOf(p)) {\n      this.$instance[p] = value\n      return true\n    }\n\n    target[p] = value\n    return true\n  }\n\n  get(target: any, p: PropertyKey, receiver: any): any {\n    if (~this.$internal.indexOf(p)) {\n      return this.$instance[p]\n    }\n\n    return target[p]\n  }\n}\n","export function objectToMap(map: URLSearchParams | Headers, item: any): any {\n  for (let key in item) {\n    if (Array.isArray(item[key])) {\n      for (let i = 0; i < item[key].length; i++) {\n        map.append(key, item[key][i])\n      }\n    } else {\n      map.append(key, item[key])\n    }\n  }\n\n  return map\n}\n","import {ErrorResponse, RequestWithHeaders } from './interfaces'\nimport * as superagent from 'superagent'\nimport {Stream, fromPromise} from 'most'\nimport {create} from '@most/create'\n\nexport function fetch(\n  input: string|RequestWithHeaders,\n  init?: RequestInit,\n  abortCallback?: (req: Request) => void\n): Stream<any> {\n\n  if (!(input instanceof Request)) {\n    input = new Request(input, init) as RequestWithHeaders\n  }\n\n  let req = superagent[input.method.toLowerCase()](input.url)\n\n  for (let header of input.headers) {\n    req.set(header[0], header[1])\n  }\n\n  return fromPromise(input.text())\n  .flatMap(body => {\n    req.send(body)\n\n    return create((add, end, error) => {\n      req.end(function(err: any, res: any) {\n        if (err) {\n          let response = new Response(err, res) as ErrorResponse\n          response.message = response.statusText\n          return error(response)\n        }\n\n        if (res.noContent === true) {\n          add(new Response())\n          return end()\n        }\n\n        res.url = (input as Request).url\n        let response = new Response(res.text, res)\n\n        add(response)\n        end()\n      })\n\n      return function abort() {\n        req.abort()\n        abortCallback(req)\n      }\n    })\n  })\n}\n","import {\n  RequestInterceptor,\n  ResponseInterceptor,\n  ErrorInterceptor\n} from './interfaces'\nimport { RxRestItem } from './index'\nimport { BodyParam } from './interfaces'\nimport { objectToMap } from './utils'\nimport { fetch } from './fetch';\n\nexport interface RequestBodyHandler<T> {\n  (body: BodyParam<T>): FormData|URLSearchParams|Body|Blob|undefined|string|Promise<any>\n}\n\nexport interface ResponseBodyHandler {\n  (body: Response): Promise<any>\n}\n\n/**\n * RxRestConfiguration\n */\nexport class RxRestConfiguration {\n  private $baseURL: string\n  private $headers: Headers = new Headers()\n  private $queryParams: URLSearchParams = new URLSearchParams()\n  public identifier: string = 'id'\n  public requestInterceptors: RequestInterceptor[] = []\n  public responseInterceptors: ResponseInterceptor[] = []\n  public errorInterceptors: ErrorInterceptor[] = []\n  public fetch: any\n  public abortCallback: (req: Request) => void = () => null\n\n  constructor() {\n      this.fetch = fetch\n  }\n\n  /**\n   * requestBodyHandler\n   * JSONify the body if it's an `RxRestItem` or an `Object`\n   *\n   * @param {FormData|URLSearchParams|Body|Blob|undefined} body\n   * @returns {any}\n   */\n  _requestBodyHandler(body: FormData|URLSearchParams|Body|Blob|undefined):\n    FormData|URLSearchParams|Body|Blob|undefined|string|Promise<any> {\n    if (!body) {\n      return undefined\n    }\n\n    if (body instanceof FormData || body instanceof URLSearchParams) {\n      return body\n    }\n\n    return body instanceof RxRestItem ? body.json() : JSON.stringify(body)\n  }\n\n  /**\n   * responseBodyHandler\n   * transforms the response to a json object\n   *\n   * @param {Response} body\n   * @reject when response is an error\n   * @returns {Promise<any>}\n   */\n  _responseBodyHandler(body: Response): Promise<any> {\n    return body.text()\n    .then(text => {\n      return text ? JSON.parse(text) : null\n    })\n  }\n\n  get responseBodyHandler(): ResponseBodyHandler {\n    return this._responseBodyHandler\n  }\n\n  set responseBodyHandler(responseBodyHandler: ResponseBodyHandler) {\n    this._responseBodyHandler = responseBodyHandler\n  }\n\n  get requestBodyHandler(): RequestBodyHandler<any> {\n    return this._requestBodyHandler\n  }\n\n  set requestBodyHandler(requestBodyHandler: RequestBodyHandler<any>) {\n    this._requestBodyHandler = requestBodyHandler\n  }\n\n  /**\n   * set baseURL\n   *\n   * @param {String} base\n   * @returns\n   */\n  set baseURL(base: string) {\n    if (base.charAt(base.length - 1) !== '/') {\n      base += '/'\n    }\n\n    this.$baseURL = base\n  }\n\n  /**\n   * get baseURL\n   *\n   * @returns {string}\n   */\n  get baseURL(): string {\n    return this.$baseURL\n  }\n\n  /**\n   * Set global query params\n   * @param {Object|URLSearchParams} params\n   */\n  set queryParams(params: any) {\n    if (params instanceof URLSearchParams) {\n      this.$queryParams = params\n      return\n    }\n\n    if (typeof params === 'string') {\n      this.$queryParams = new URLSearchParams(params)\n      return\n    }\n\n    this.$queryParams = objectToMap(new URLSearchParams(), params)\n  }\n\n  /**\n   * Get global query params\n   * @return {URLSearchParams}\n   */\n  get queryParams(): any {\n    return this.$queryParams\n  }\n\n  /**\n   * set global headers\n   * @param {Object|Headers} params\n   */\n  set headers(params: any) {\n     if (params instanceof Headers) {\n      this.$headers = params\n      return\n    }\n\n    this.$headers = objectToMap(new Headers(), params)\n }\n\n  /**\n   * Get global headers\n   * @return Headers\n   */\n  get headers(): any {\n    return this.$headers\n  }\n\n}\n","import { RxRestConfiguration } from './RxRestConfiguration';\nimport {\n  RequestInterceptor,\n  ResponseInterceptor,\n  ErrorInterceptor,\n  ErrorResponse,\n  BodyParam\n} from './interfaces';\nimport { RxRestCollection, RxRestItem } from './index'\nimport { Stream, throwError, of } from 'most'\nimport { create } from '@most/create'\nimport { objectToMap } from './utils';\n\nconst fromPromise = function(promise: Promise<any>) {\n  return create((add, end, error) => {\n    promise\n    .then((v) => {\n      add(v)\n      end()\n    })\n    .catch(error)\n  })\n}\n\nexport class RxRest<T> {\n  protected $route: string[]\n  $fromServer: boolean = false\n  $queryParams: URLSearchParams = new URLSearchParams()\n  $headers: Headers = new Headers()\n  config: RxRestConfiguration\n\n  /**\n   * constructor\n   *\n   * @param {String} [route] the resource route\n   */\n  constructor(config: RxRestConfiguration = new RxRestConfiguration(), route?: string[]) {\n    this.$route = route === undefined ? [] : [...route]\n    this.config = config\n  }\n\n  protected addRoute(route: string): void {\n    this.$route.push.apply(this.$route, route.split('/'))\n  }\n\n  /**\n   * one\n   *\n   * @param {String} route\n   * @param {any} id\n   * @returns {RxRestItem}\n   */\n  one<T>(route: string, id?: any): RxRestItem<T> {\n    this.addRoute(route)\n    let o = {} as T\n    if (id) {\n      o[this.config.identifier] = id\n    }\n\n    return new RxRestItem<T>(this.$route, o, this.config)\n  }\n\n  /**\n   * all\n   *\n   * @param {String} route\n   * @returns {RxRestCollection}\n   */\n  all<T>(route: string): RxRestCollection<T> {\n    this.addRoute(route)\n    return new RxRestCollection<T>(this.$route, undefined, this.config)\n  }\n\n  /**\n   * fromObject\n   *\n   * @param {String} route\n   * @param {Object|Object[]} element\n   * @returns {RxRestItem|RxRestCollection}\n   */\n  fromObject<T>(route: string, element: T|T[]): RxRestItem<T>|RxRestCollection<T> {\n    this.addRoute(route)\n    if (Array.isArray(element)) {\n      return new RxRestCollection<T>(this.$route, element, this.config)\n    }\n\n    return new RxRestItem<T>(this.$route, element, this.config)\n  }\n\n  /**\n   * @access private\n   * @param {BodyParam} body\n   * @return {BodyParam|RxRestItem}\n   */\n  protected withBody(body: BodyParam<T>) {\n    return body ? body : this\n  }\n\n  /**\n   * post\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  post(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('POST', this.withBody(body))\n  }\n\n  /**\n   * remove\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  remove(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('DELETE')\n  }\n\n  /**\n   * get\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  get(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('GET')\n  }\n\n  /**\n   * put\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  put(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('PUT', this.withBody(body))\n  }\n\n  /**\n   * patch\n   *\n   * @param {Body|Blob|FormData|URLSearchParams|Object|RxRestItem} [body]\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  patch(body?: BodyParam<T>, queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('PATCH', this.withBody(body))\n  }\n\n  /**\n   * head\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  head(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('HEAD')\n  }\n\n  /**\n   * trace\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  trace(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('TRACE')\n  }\n\n  /**\n   * options\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  options(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('OPTIONS')\n  }\n\n  /**\n   * URL\n   *\n   * @returns {string}\n   */\n  get URL(): string {\n    return `${this.config.baseURL}${this.$route.join('/')}`\n  }\n\n  /**\n   * set local query params\n   * @param {Object|URLSearchParams} params\n   */\n  set queryParams(params: any) {\n    if (!params) {\n      return\n    }\n\n    if (params instanceof URLSearchParams) {\n      this.$queryParams = params\n      return\n    }\n\n    this.$queryParams = objectToMap(new URLSearchParams(), params)\n  }\n\n  /**\n   * Sets local query params useful to add params to a custom request\n   * @param {Object|URLSearchParams}\n   * @return this\n   */\n  setQueryParams(params: any): RxRest<T> {\n    this.queryParams = params\n    return this\n  }\n\n  /**\n   * Sets local headers useful to add headers to a custom request\n   * @param {Object|URLSearchParams}\n   * @return this\n   */\n  setHeaders(params: any): RxRest<T> {\n    this.headers = params\n    return this\n  }\n\n  /**\n   * Get local query params\n   * @return URLSearchParams\n   */\n  get queryParams(): any {\n    return this.$queryParams\n  }\n\n  /**\n   * Get request query params\n   * Combine local and global query params\n   * Local query params are overriding global params\n   * @return {String}\n   */\n  get requestQueryParams(): string {\n    let params = new URLSearchParams()\n\n    for (let param of this.config.queryParams) {\n      params.append(param[0], param[1])\n    }\n\n    for (let param of this.queryParams) {\n      params.append(param[0], param[1])\n    }\n\n    let str = params.toString()\n\n    if (str.length) {\n      return '?' + str\n    }\n\n    return ''\n  }\n\n  /**\n   * Set local headers\n   * @param {Object|Headers} params\n   */\n  set headers(params: any) {\n    if (!params) {\n      return\n    }\n\n     if (params instanceof Headers) {\n      this.$headers = params\n      return\n    }\n\n    this.$headers = objectToMap(new Headers(), params)\n }\n\n  /**\n   * Get local headers\n   * @return Headers\n   */\n  get headers(): any {\n    return this.$headers\n  }\n\n  /**\n   * get request Headers\n   * Combine local and global headers\n   * Local headers are overriding global headers\n   *\n   * @returns {Headers}\n   */\n  get requestHeaders(): Headers {\n    let headers = new Headers()\n\n    for (let header of this.headers) {\n      headers.append(header[0], header[1])\n    }\n\n    for (let header of this.config.headers) {\n      headers.append(header[0], header[1])\n    }\n\n    return headers\n  }\n\n  /**\n   * expandInterceptors\n   *\n   * @param {RequestInterceptor[]|ResponseInterceptor[]|ErrorInterceptor[]} interceptors\n   * @returns {Stream<any>} fn\n   */\n  private expandInterceptors(\n    interceptors: RequestInterceptor[]|ResponseInterceptor[]|ErrorInterceptor[]\n  ) {\n    return function(origin: any): Stream<any> {\n      return (<any>interceptors).reduce(\n        (obs: Stream<any>, interceptor: any) =>\n          obs.concatMap(value => {\n            let result = interceptor(value)\n            if (result === undefined) {\n              return of(value)\n            }\n\n            if (result instanceof Promise) {\n              return fromPromise(result)\n            }\n\n            if (result instanceof Stream) {\n              return result\n            }\n\n            return of(result)\n          }),\n        of(origin)\n      )\n    }\n  }\n\n  /**\n   * request\n   *\n   * @param {string} method\n   * @param {RxRestItem|FormData|URLSearchParams|Body|Blob|undefined|Object} [body]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  request(method: string, body?: BodyParam<T>): Stream<RxRestItem<T> & T> {\n    let requestOptions = {\n      method: method,\n      headers: <Headers> this.requestHeaders,\n      body: this.config.requestBodyHandler(body)\n    }\n\n    let request = new Request(this.URL + this.requestQueryParams, requestOptions);\n\n    let stream = <Stream<RxRestItem<T> & T>> of(request)\n    .flatMap(this.expandInterceptors(this.config.requestInterceptors))\n    .flatMap(request => this.config.fetch(request, null, this.config.abortCallback))\n    .flatMap(this.expandInterceptors(this.config.responseInterceptors))\n    .flatMap(body => fromPromise(this.config.responseBodyHandler(body)))\n    .flatMap(body => {\n      if (!Array.isArray(body)) {\n        let item: RxRestItem<T>\n        if (this instanceof RxRestItem) {\n          item = this\n          item.element = body as T\n        } else {\n          item = new RxRestItem(this.$route, body as T, this.config)\n        }\n\n        item.$fromServer = true\n        return create((add, end, error) => {\n          add(item)\n          end(item)\n        })\n      }\n\n      let collection = new RxRestCollection<T>(this.$route, body.map((e: T) => {\n        let item = new RxRestItem(this.$route, e, this.config)\n        item.$fromServer = true\n        return item\n      }), this.config)\n\n      return create((add, end, error) => {\n        for (let item of collection) {\n          add(item)\n        }\n\n        end(collection)\n      })\n    })\n    .recoverWith(body => {\n      return of(body)\n      .flatMap(this.expandInterceptors(this.config.errorInterceptors))\n      .flatMap((body: ErrorResponse) => throwError(body))\n    })\n\n    return stream\n  }\n}\n","import { Stream } from 'most'\nimport { RxRestProxyHandler } from './RxRestProxyHandler'\nimport { RxRest as AbstractRxRest } from './RxRest'\nimport { RxRestConfiguration } from './RxRestConfiguration';\n\nexport class RxRestItem<T> extends AbstractRxRest<T> {\n  $element: T = {} as T;\n\n  /**\n   * constructor\n   *\n   * @param {string[]} route\n   * @param {T} [element]\n   * @return {Proxy}\n   */\n  constructor(route: string[], element?: T, config?: RxRestConfiguration) {\n    super(config, route)\n\n    if (element !== undefined) {\n      this.element = element\n    }\n\n    const proxy = new Proxy(this.$element, new RxRestProxyHandler<T>(this))\n\n    return <RxRestItem<T> & T> proxy\n  }\n\n  /**\n   * save - POST or PUT according to $fromServer value\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  save(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request(this.$fromServer === true ? 'PUT' : 'POST', this)\n  }\n\n  /**\n   * set element\n   *\n   * @param {T} element\n   */\n  set element(element: T) {\n    for (let i in element) {\n      if (i === this.config.identifier && !this.$element[this.config.identifier]) {\n        this.$route.push('' + element[i])\n      }\n\n      this.$element[i] = element[i]\n    }\n  }\n\n  /**\n   * get element\n   *\n   * @return {T}\n   */\n  get element(): T {\n    return this.$element\n  }\n\n  /**\n   * get plain object\n   *\n   * @return {T}\n   */\n  plain(): T {\n    return this.element\n  }\n\n  /**\n   * Get json string\n   * @return {string}\n   */\n  json(): string {\n    return JSON.stringify(this.plain())\n  }\n\n  /**\n   * Clone\n   * @return {RxRestItem<T>}\n   */\n  clone(): RxRestItem<T> {\n    let route = this.$route\n\n    if (this.$element[this.config.identifier]) {\n      route = route.slice(0, this.$route.length - 1)\n    }\n\n    let clone = new RxRestItem(route, this.$element, this.config)\n    clone.$fromServer = this.$fromServer\n    return clone\n  }\n}\n\nexport class RxRestCollection<T> extends AbstractRxRest<T>\n  implements Iterable<RxRestItem<T>>, RxRestCollection<T> {\n  length: number;\n  $elements: RxRestItem<T>[] = [];\n  [index: number]: RxRestItem<T>;\n\n  /**\n   * constructor\n   *\n   * @param {string[]} route\n   * @param {T[]|RxRestItem<T>[]]} [elements]\n   * @return {Proxy}\n   */\n  constructor(route: string[], elements?: T[]|RxRestItem<T>[], config?: RxRestConfiguration) {\n    super(config, route)\n\n    if (elements !== undefined) {\n      this.elements = (elements as any).map((e: any) =>\n        e instanceof RxRestItem ? e.clone() : new RxRestItem(this.$route, e)\n      )\n    }\n\n    const proxy = new Proxy(this.$elements, new RxRestProxyHandler<T>(this))\n\n    return <RxRestCollection<T> & T> proxy\n  }\n\n  [Symbol.iterator]() {\n    let index = 0\n    let elements = this.$elements\n\n    return {\n      next(): IteratorResult<RxRestItem<T>> {\n        return index < elements.length ?\n          {value: elements[index++], done: false} : {value: undefined, done: true}\n      }\n    }\n  }\n\n  /**\n   * getList - fetch a collection\n   *\n   * @param {Object|URLSearchParams} [queryParams]\n   * @param {Object|Headers} [headers]\n   * @returns {Stream<RxRestItem|RxRestCollection>}\n   */\n  getList(queryParams?: Object|URLSearchParams, headers?: Object|Headers):\n    Stream<RxRestItem<T>|RxRestCollection<T>> {\n    this.queryParams = queryParams\n    this.headers = headers\n\n    return this.request('GET')\n  }\n\n  /**\n   * set elements\n   *\n   * @param {T[]} elements\n   */\n  set elements(elements: RxRestItem<T>[]) {\n    this.$elements = elements\n    this.length = elements.length\n  }\n\n  /**\n   * get elements\n   * @return {RxRestItem<T>[]}\n   */\n  get elements(): RxRestItem<T>[] {\n    return this.$elements\n  }\n\n  /**\n   * plain\n   *\n   * @returns {T[]}\n   */\n  plain(): T[] {\n    return this.elements.map(e => e.plain())\n  }\n\n  /**\n   * json\n   *\n   * @returns {String}\n   */\n  json(): string {\n    return JSON.stringify(this.plain())\n  }\n\n  /**\n   * clone\n   *\n   * @returns {RxRestCollection}\n   */\n  clone(): RxRestCollection<T> {\n    return new RxRestCollection<T>(this.$route, this.$elements, this.config)\n  }\n}\n\nexport class RxRest {\n  constructor(private config: RxRestConfiguration) {\n  }\n\n  one<T>(route: string, id?: any): RxRestItem<T> & T {\n    let r = new AbstractRxRest(this.config)\n    return r.one.call(r, route, id)\n  }\n\n  all<T>(route: string): RxRestCollection<T> & T {\n    let r = new AbstractRxRest(this.config)\n    return r.all.call(r, route)\n  }\n\n  fromObject<T>(route: string, element: T|T[]): (RxRestItem<T> & T) | (RxRestCollection<T> & T) {\n    let r = new AbstractRxRest(this.config)\n    return r.fromObject.call(r, route, element)\n  }\n}\n\nexport { RxRestConfiguration }"],"names":["target","$instance","$internal","concat","Object","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","p","attributes","indexOf","defineProperty","value","receiver","map","item","key","Array","isArray","i","length","append","input","init","abortCallback","Request","req","superagent","method","toLowerCase","url","headers","header","set","fromPromise","text","flatMap","send","body","create","add","end","error","err","res","response","Response","message","statusText","noContent","abort","Headers","URLSearchParams","fetch","undefined","FormData","RxRestItem","json","JSON","stringify","then","parse","_responseBodyHandler","responseBodyHandler","_requestBodyHandler","requestBodyHandler","base","charAt","$baseURL","params","$queryParams","objectToMap","$headers","promise","v","catch","config","RxRestConfiguration","route","$route","push","apply","split","id","addRoute","o","identifier","RxRestCollection","element","queryParams","request","withBody","interceptors","origin","reduce","obs","interceptor","concatMap","result","of","Promise","Stream","requestOptions","requestHeaders","URL","requestQueryParams","stream","expandInterceptors","requestInterceptors","responseInterceptors","$fromServer","collection","e","recoverWith","errorInterceptors","throwError","baseURL","join","param","str","toString","proxy","Proxy","$element","RxRestProxyHandler","plain","slice","clone","AbstractRxRest","elements","$elements","Symbol","iterator","index","done","r","one","call","all","fromObject"],"mappings":"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"}